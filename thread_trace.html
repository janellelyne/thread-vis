<!doctype html>
<html>

<head>
      <title>Horizontal Bar Chart</title>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js" integrity="sha256-R4pqcOYV8lt7snxMQO/HSbVCFRPMdrhAFMH+vr9giYI=" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/moment@2.24.0/moment.min.js"></script>
      <script src="js/utils.js"></script>
      <style>
      canvas{
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
      }
      </style>
</head>

<body>
      <div style="width:75%;">
            <canvas id="canvas"></canvas>
      </div>
      <br>
      <br>
      <button id="randomizeData">Randomize Data</button>
      <button id="addDataset">Add Dataset</button>
      <button id="removeDataset">Remove Dataset</button>
      <button id="addData">Add Data</button>
      <button id="removeData">Remove Data</button>
      <script>
            var Secs = 0;
            var STATUS = ['Thread Added', 'Thread Idle', 'Thread Working', 'Deadlock', 'Thread Done'];
            var randomScalingFactor = function() {
                  return Math.round(Math.random() * 100);
            };

            var config = {
                  type: 'line',
                  data: {
                        yLabels: ['Thread Added', 'Thread Idle', 'Thread Working', 'Deadlock', 'Thread Done'],
                        datasets: [{
                              label: 'Thread 0',
                              backgroundColor: window.chartColors.red,
                              borderColor: window.chartColors.red,
                              pointRadius: 6,
                              //steppedLine: true,
                              data: [
                                  6
                              ],
                              fill: false,
                        },]
                  },
                  options: {
                           legend: {
                                     display: true,
                                     position: 'right'
                            },
                        responsive: true,
                        title: {
                              display: true,
                              text: 'Thread Trace Chart'
                        },
                        tooltips: {
                              mode: 'index',
                              intersect: false,
                        },
                        hover: {
                              mode: 'nearest',
                              intersect: true
                        },
                        scales: {
                              xAxes: {
                                    display: true,
                                    scaleLabel: {
                                          display: true,
                                          labelString: 'Month'
                                    }
                              },
                               yAxes: [{
                                 display: true,
                                 type: 'category',
                                 scaleLabel: {
                                   display: true,
                                   labelString: 'Value'
                                 },
                                 /*ticks: {
                                   min: 0,
                                   max: 6,
                                   stepSize: 1,
                                   suggestedMin: 0,
                                   suggestedMax: 6,
                                   callback: function(label, index, labels) {
                                     switch (label) {
                                       case 0:
                                         return '';
                                       case 1:
                                         return 'Thread Done';
                                       case 2:
                                         return 'Thread DeadLock';
                                       case 3:
                                         return 'Thread Work';
                                       case 4:
                                         return 'Thread Wait';
                                       case 5:
                                         return 'Thread Create';
                                          case 6:
                                         return '';
                                     }
                                   }
                                 },*/
                        }]
                  }}
            };

            window.onload = function() {
                  var ctx = document.getElementById('canvas').getContext('2d');
                  window.myLine = new Chart(ctx, config);
            };

            document.getElementById('randomizeData').addEventListener('click', function() {
                  config.data.datasets.forEach(function(dataset) {
                        dataset.data = dataset.data.map(function() {
                              return randomScalingFactor() % 5;
                        });
                  });

                  window.myLine.update();
            });

            var colorNames = Object.keys(window.chartColors);
            document.getElementById('addDataset').addEventListener('click', function() {
                  var colorName = colorNames[config.data.datasets.length % colorNames.length];
                  var newColor = window.chartColors[colorName];
                  var newDataset = {
                        label: 'Thread ' + config.data.datasets.length,
                        backgroundColor: newColor,
                        borderColor: newColor,
                        pointRadius: 6,
                        //steppedLine: true,
                        data: [],
                        fill: false
                  };             
                        newDataset.data.push("Request Added");
                  

                  config.data.datasets.push(newDataset);
                  window.myLine.update();
            });

            document.getElementById('addData').addEventListener('click', function() {
                  if (config.data.datasets.length > 0) {
                        Secs = Secs + 5;
                        config.data.labels.push(Secs + " secs");

                        config.data.datasets.forEach(function(dataset) {
                              dataset.data.push(STATUS[randomScalingFactor() % STATUS.length]);
                        });

                        window.myLine.update();
                  }
            });

            document.getElementById('removeDataset').addEventListener('click', function() {
                  config.data.datasets.splice(0, 1);
                  window.myLine.update();
            });

            document.getElementById('removeData').addEventListener('click', function() {
                  config.data.labels.splice(-1, 1); // remove the label first

                  config.data.datasets.forEach(function(dataset) {
                        dataset.data.pop();
                  });

                  window.myLine.update();
            });

      </script>
</body>

</html>